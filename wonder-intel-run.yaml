apiVersion: batch/v1
kind: Job
metadata:
  # Name for the on-demand job
  name: wonder-intel-run
spec:
  # This 'template' block was inside 'jobTemplate.spec'
  template:
    spec:
      nodeSelector:
        cloud.google.com/gke-nodepool: intel-pool
      containers:
      - name: wonder
        image: us-central1-docker.pkg.dev/wonder-477103/wonder/wonder:v5
        command: ["/bin/sh", "-c", "python main.py --model gs://wayne315315/wonder/model_bfloat16/woof.keras --other gs://wayne315315/wonder/model_bfloat16/base.keras --data meow.tfrecord --policy mixed_bfloat16 --round 1000"]
        resources:
          requests:
            cpu: "28"
            memory: "110Gi"
          limits:
            cpu: "32"
            memory: "120Gi"

      # 2. This is the "key" that unlocks the node
      #    Matching your NoExecute taint
      tolerations:
      - key: "intel"
        operator: "Equal"
        value: "wonder"
        effect: "NoExecute"
        
      restartPolicy: Never
      
  # Optional: Cleans up the pod 60 seconds after it finishes
  ttlSecondsAfterFinished: 60
  